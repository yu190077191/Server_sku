@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>List</title>
    <script type="text/javascript" src="@Url.Content("~/Nestle/Scripts/jquery-1.8.2.js")"></script>
    @*<script type="text/javascript" src="~/Nestle/Scripts/json2.js"></script>*@
    <script type="text/javascript" src="~/Nestle/Scripts/nestle.json.js"></script>
    <style>
        button {
            cursor: pointer;
        }

            button:hover {
                border-color: #000000;
            }

        .titlediv {
            line-height: 50px;
            text-align: center;
            font-size: xxx-large;
            margin-top: 30px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #d7d7d7;
            padding: 15px;
            border-radius: 5px;
        }

        .formdiv {
            line-height: 30px;
            text-align: center;
            margin-top: 40px;
            margin-bottom: 40px;
            font-size: x-large;
            width: 85%;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #d7d7d7;
            border-radius: 5px;
        }

        .desdiv {
            width: 85%;
            margin-left: auto;
            margin-right: auto;
        }

        .addrowbtndiv {
            width: 85%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 30px;
        }

            .addrowbtndiv button {
                width: 80px;
            }

        .tablediv {
            width: 85%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #d7d7d7;
            border-collapse: collapse; /* 移除单元格之间的间隔 */
            padding: 5px;
        }

        .formspan {
            display: block;
            padding: 10px
        }

        textarea {
            width: 98%;
            height: 100%;
            resize: none;
            padding: 5px;
            border: 1px solid #d7d7d7;
        }

        input {
            width: 85%;
            height: 100%;
            resize: none;
            padding: 5px;
            border: 1px solid #d7d7d7;
        }

        .newInfodes {
            width: 85%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .btndiv {
            width: 85%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        button {
            padding: 5px;
            background-color: white;
            border: 1px solid #d7d7d7;
            border-radius: 3px;
        }

        .btndiv button {
            margin: 20px;
            width: 100px;
        }
    </style>
</head>
<body>
    <div style="width:100%">
        <div class="titlediv">
            SKU Registration System
        </div>
        <div class="formdiv">
            <span class="formspan"> Barcode ExceptionalApprove Form </span>
        </div>
        <div class="desdiv">
            <div>
                Nestle  Nestle Nestle Nestle Nestle Nestle  Nestle  Nestle Nestle Nestle Nestle Nestle  Nestle  Nestle Nestle Nestle Nestle Nestle
                Nestle  Nestle Nestle Nestle Nestle Nestle  Nestle  Nestle Nestle Nestle Nestle Nestle  Nestle  Nestle Nestle Nestle Nestle Nestle
            </div>
            <br>
            <div> Business:</div>
            <br>
            <div> BusinessJustification:</div>
            <div> The Bar Code associatedto Material code is maintained data:</div>
        </div>
        <div class="addrowbtndiv">
            <button onclick="addrow('0');">加一行</button>
        </div>
        <div class="tablediv" >
            <table id="oldDataTable">
                <tr>
                    <td style="width:3%">Id</td>
                    <td style="width: 3%">Number</td>
                    <td style="width:3%">SKUCode</td>
                    <td>SKUDescription</td>
                    <td style="width:5%">NetWeight</td>
                    <td style="width:5%">Packing</td>
                    <td style="width:10%">BarCode</td>
                    <td style="width:5%">Length</td>
                    <td style="width:5%">Width</td>
                    <td style="width:5%">Height</td>
                    <td style="width:5%">ShelfLife</td>
                    <td style="width:5%">GrossWeight</td>
                    <td style="width:8%;text-align:center">操作</td>
                </tr>
                @*<tr>
                    <td style="width: 3%;">1</td>
                    <td style="width: 3%;">1</td>
                    <td style="width:3%"><input type="text" class="SKUCode" value="12572107"></td>
                    <td><textarea class="SKUDescription">雀巢脆脆鲨鲨刻能榛果味涂层威化饼干分享装@20(10X20)CNCCS Sharknnuts Hzn Wfr SbgPk20(10x20)CN</textarea></td>
                    <td style="width:5%"><input type="text"  class="NetWeight" value="200克"></td>
                    <td style="width:5%"><input type="text"  class="Packing" value="Bag"></td>
                    <td style="width:10%"><input type="text" class="BarCode" value="6917878065601"></td>
                    <td style="width:5%"><input type="text"  class="Length" value="248"></td>
                    <td style="width:5%"><input type="text"  class="Width" value="70"></td>
                    <td style="width:5%"><input type="text"  class="Height" value="215"></td>
                    <td style="width:5%"><input type="text"  class="ShelfLife" value="12months"></td>
                    <td style="width:5%"><input type="text"  class="GrossWeight" value="218.5g"></td>
                    <td style="width:8%; text-align: center"><button onclick="copyrow()">复制</button> <button onclick="delrow(this)">删除</button></td>
                </tr>*@
            </table>
        </div>
        <div class="newInfodes">
            <div>As Buiness internal transformation , there is change toexisting bar code need to be modified as :</div>
        </div>
        <div class="tablediv" id="updateDateDiv">
            <table id="updateDateTable">
                <tr id="updateDatetr">
                    <td style="width:3%">Id</td>
                    <td style="width: 3%">Number</td>
                    <td style="width:3%">SKUCode</td>
                    <td>SKUDescription</td>
                    <td style="width:5%">NetWeight</td>
                    <td style="width:5%">Packing</td>
                    <td style="width:10%">BarCode</td>
                    <td style="width:5%">Length</td>
                    <td style="width:5%">Width</td>
                    <td style="width:5%">Height</td>
                    <td style="width:5%">ShelfLife</td>
                    <td style="width:5%">GrossWeight</td>
                </tr>
                @*<tr>
                    <td style="width: 3%">1</td>
                    <td style="width: 3%">1</td>
                    <td style="width:3%"><input type="text" value="12572107"></td>
                    <td><textarea>雀巢脆脆鲨鲨刻能榛果味涂层威化饼干分享装@20(10X20)CNCCS Sharknnuts Hzn Wfr SbgPk20(10x20)CN</textarea></td>
                    <td style="width:5%"><input type="text" value="200克"></td>
                    <td style="width:5%"><input type="text" value="Bag"></td>
                    <td style="width:10%"><input type="text" value="6917878065601"></td>
                    <td style="width:5%"><input type="text" value="248"></td>
                    <td style="width:5%"><input type="text" value="70"></td>
                    <td style="width:5%"><input type="text" value="215"></td>
                    <td style="width:5%"><input type="text" value="12months"></td>
                    <td style="width:5%"><input type="text" value="218.5g"></td>
                </tr>*@
            </table>
        </div>
        <div class="btndiv">
            <button onclick="save('0')">保 存</button>
            <button onclick="save('1')">提 交</button>
            <button>撤 回</button>
            <button>提交备案</button>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">
     function getRootUrl() {
            return "@(Url.Content("~/"))";
        }
    $(document).ready(function () {
        var dataCount = $('#oldDataTable tr').length;
        if (dataCount == 1) {
            addrow('0');
        }
    });

    function getTempLateHtml(id, number, isNewData, code, desc, netwht, pak, bar, len, wd, hg, sl, gw) {
        var tempLateHtml = "<tr class=\"data\" dataType=\"" + isNewData+"\"><td style = \"width: 3%;\">" + id + "</td>";
        tempLateHtml += "<td style=\"width: 3%;\"><input class=\"Number\"  type=\"text\" readonly value ='" + number +"'></td>";
        tempLateHtml += "<td style=\"width: 3%;\"><input class=\"SKUCode\"  type=\"text\" value=\"" + code +"\"></td>";
        tempLateHtml += " <td><textarea class=\"SKUDescription\" value =\"" + desc + "\">" + desc+"</textarea></td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"NetWeight\"  type=\"text\" value=\"" + netwht+"\"> </td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"Packing\"  type=\"text\" value=\"" + pak +"\"> </td>";
        tempLateHtml += " <td style=\"width:10% \"><input class=\"BarCode\"  type=\"text\" value=\"" + bar +"\"> </td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"Length\"  type=\"text\" value=\"" + len +"\"> </td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"Width\"  type=\"text\" value=\"" + wd +"\"> </td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"Height\"  type=\"text\" value=\"" + hg +"\"> </td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"ShelfLife\"  type=\"text\" value=\"" + sl +"\"> </td>";
        tempLateHtml += " <td style=\"width: 5% \"><input class=\"GrossWeight\"  type=\"text\" value=\"" + gw +"\"> </td>";
        /*tempLateHtml += " <td style=\"width: 5% \"><input type=\"text\" value=\"" + gw +"\"></td>";*/
        if (isNewData == "0") {
            tempLateHtml += " <td style=\"width: 5% ;text-align:center;\"><button onclick=\"addrow('0',this)\">复制</button> <button onclick=\"delrow(this)\">删除</button></td></tr>";
        }
        return tempLateHtml;
    }
    function addrow(id,el) {
        //获取选中行的值
        var code = '';
        var desc = '';
        var netwht = '';
        var pak = '';
        var bar = '';
        var len = '';
        var wd = '';
        var hg = '';
        var sl = '';
        var gw = '';
        if (el != undefined) {
            var currenttr = $(el).parent().parent();
            code = $(currenttr).find('.SKUCode').val();
            desc = $(currenttr).find('.SKUDescription').val();
            netwht = $(currenttr).find('.NetWeight').val();
            pak = $(currenttr).find('.Packing').val();
            bar = $(currenttr).find('.BarCode').val();
            len = $(currenttr).find('.Length').val();
            wd = $(currenttr).find('.Width').val();
            hg = $(currenttr).find('.Height').val();
            sl = $(currenttr).find('.ShelfLife').val();
            gw = $(currenttr).find('.GrossWeight').val();
        }
        
        var maxNumber = getMaxNumber();
        var tempLateOldDataStr = getTempLateHtml(id, (maxNumber + 1), '0', code,  desc , netwht , pak , bar ,  len , wd , hg , sl , gw );
        var tempLateUpdateStr =  getTempLateHtml(id, (maxNumber + 1), '1', code,  desc , netwht , pak , bar ,  len , wd , hg , sl , gw );
        $("#oldDataTable").append(tempLateOldDataStr);
        $("#updateDateTable").append(tempLateUpdateStr);
    }
    function copyrow(el) {
        
        var clonedRow = $(el).parent().parent().clone();
        //更新number
        var number = getMaxNumber();
        var numbertdDOM = $(clonedRow).children()[1];
        var numberinputDOM = $(numbertdDOM).children();
        $(numberinputDOM).val((number));
        $('#oldDataTable').append(clonedRow);
        //删除最后操作列
        
        var updateRowClone = $(el).parent().parent().clone();
        updateRowClone.children()[updateRowClone.children().length - 1].remove();
        var updatenumbertdDOM = $(updateRowClone).children()[1];
        var updatenumberinputDOM = $(updatenumbertdDOM).children();
        $(updatenumberinputDOM).val((number));
        $("#updateDateTable").append(updateRowClone);
    }
    function delrow(el) {
        
        //旧数据DOM
        var trDOMOld = $(el).parent().parent();
        //取出number删除新数据DOM
        var numbertrDOM = $(el).parent().siblings()[1];
        var numbertdDOM = $(numbertrDOM).children();
        var numberOldData = $(numbertdDOM).val();
        //删除dom
        trDOMOld.remove();
        var updatetrDOM = $("#updateDateTable input[value='" + numberOldData + "']").parent().parent();
        $(updatetrDOM).remove();
     }
    function getMaxNumber() {
        var trLength = $('#oldDataTable tr').length;
        if (trLength == 1) {
            return 0;
        }
        else {
            var elLasttrDOM = $('#oldDataTable tr')[trLength - 1];
            var eltdDOM = $(elLasttrDOM).children()[1];
            var numberValue = $($(eltdDOM).children()[0]).val();
            return parseInt(numberValue);
        }
    }
    function save(State) {
        var model = new Object();
        listModel = [];
        model.Id = "0";
        model.State = State;
        //保存 status =1 ; 提交status =0;
        
        $(".data").each(function (index, ele) {
           var modelItem = new Object();
            var el = $(ele);
            var dataType = el.attr('dataType');
            var code = el.find('.SKUCode').val();
            var des = el.find('.SKUDescription').val();
            var netwht = el.find('.NetWeight').val();
            var pak = el.find('.Packing').val();
            var bar = el.find('.BarCode').val();
            var len = el.find('.Length').val();
            var wd = el.find('.Width').val();
            var hg = el.find('.Height').val();
            var sl = el.find('.ShelfLife').val();
            var gw = el.find('.GrossWeight').val();

            modelItem.number = (index+1);
            modelItem.DataIsNew = dataType;
            modelItem.SKUCode = code;
            modelItem.SKUDescription = des;
            modelItem.NetWeight = netwht;
            modelItem.Packing = pak;
            modelItem.BarCode = bar;
            modelItem.Length = len;
            modelItem.Width = wd;
            modelItem.Height = hg;
            modelItem.ShelfLife = sl;
            modelItem.GrossWeight = gw;

            listModel.push(modelItem);
        });
        model.ListSpecialApprovalItemModel = listModel;
        var jsondata = $.toJSON(model);
        
        $.post(getRootUrl() + "SpecialApproval/SaveSpecialApproval", { jsonmodel: jsondata  },
            function (data) {
                
                alert(data.data.Message);
            });
    }
</script>